@using BlogEngine.Core
@using BlogEngine.Core.Web.Extensions

@helper MakeNote(string content)
    {
    <div class="note" style="border: 1px solid black; width: 90%; padding: 5px; margin-left: 15px;">
      <p>
          <strong>Note</strong>&nbsp;&nbsp; @content
       </p>
    </div>
}

@helper ExtensionList(bool isenabled)
    {
    var extensions = ExtensionManager.Extensions.Where(x => x.Key != "MetaExtension").ToList();
    var tableId = "tblEnabledExtensions";
    var onClick = "$(this).text($(this).text() == 'Show' ? 'Hide' : 'Show'); $.cookie('ToggleDisabledExtensions', '{0}', [x]); return {1}('tblDisabledExtensions');";
    var disabledDisplay = "";

    extensions.Sort(
        (e1, e2) => e1.Value.Priority == e2.Value.Priority ? string.CompareOrdinal(e1.Key, e2.Key) : e1.Value.Priority.CompareTo(e2.Value.Priority));

    List<ManagedExtension> manExtensions = new List<ManagedExtension>();

    foreach (KeyValuePair<string, ManagedExtension> ext in extensions)
    {
        var oExt = ExtensionManager.GetExtension(@ext.Key);
        if (oExt.Enabled == isenabled)
        {
            manExtensions.Add(oExt);
        }
    }

    if(isenabled)
    {
        <h1>@Resources.labels.extensions (@manExtensions.Count)</h1>
    }
    else
    {
        @* show/hide disabled extensions *@
        var ShowHide = "Hide";
        if (Request.Cookies["ToggleDisabledExtensions"] == null)
        {
            var cookie = new HttpCookie("ToggleDisabledExtensions", "Hide") { Expires = DateTime.Now.AddMonths(1) };
            Response.Cookies.Add(cookie);
            onClick = string.Format(onClick, "Hide", "Hide");
        }
        else
        {
            ShowHide = Request.Cookies["ToggleDisabledExtensions"].Value;

            if (ShowHide == "Show")
            {
                onClick = string.Format(onClick, "Hide", "Show");
                disabledDisplay = "display: none";
            }
            else
            {
                onClick = string.Format(onClick, "Show", "Hide");
            }
        }
        onClick = onClick.Replace("[x]", "{ expires: 30 }");
        tableId = "tblDisabledExtensions";
        <h2 style="margin-top:20px">Disabled Extensions (@manExtensions.Count) <a href="#" id="DisabledToggle" onclick="@Html.Raw(@onClick)" class="toggle">@ShowHide</a></h2>
    }
    
        
    <table id="@tableId" class="beTable rounded" style="@disabledDisplay">
        <thead>
        <tr>
            <th width="150">Name</th>
            <th width="60">Version</th>
	        <th width="auto">Description</th>
            <th width="150">Author</th>
            <th width="100">&nbsp;</th>
            <th width="60">Priority</th>
            <th width="20">&nbsp;</th>
            <th width="20">&nbsp;</th>
        </tr>
        </thead>
        <tbody>
        @{
            var cnt = 0;
            var cls = "";
            foreach (var x in manExtensions)
            {
                cnt++;
                cls = (cnt % 2 == 0) ? "alt" : "";
                var enabled = @x.Enabled ? @Resources.labels.disable : @Resources.labels.enable;
                        
                <tr class="@cls">
                    <td>@x.Name</td>
                    <td>@x.Version</td>
                    <td>@Html.Raw(x.Description)</td>
                    <td>@Html.Raw(x.Author)</td>
                    <td>
                    <ul class="rowTools">
                        <li>
                            <a class="toolsAction" href="#"><span class="">Tools</span></a>
                            <ul class="rowToolsMenu">
                                <li><a href="#" class="unapproveButton unapproveAction">@enabled</a></li>
                                <li><a href="#" class="viewButton viewAction">View</a></li>
                            </ul>
                        </li>
                    </ul>
                    </td>
                    <td>@x.Priority</td>
                    <td align="center" valign="middle" style="width:20px;">
                    <input type="image" name="ctl00$cphAdmin$ctl00$gridExtensionsList$ctl03$btnPriorityUp" id="ctl00_cphAdmin_ctl00_gridExtensionsList_ctl03_btnPriorityUp" src="../images/action-up.png" alt="Up" align="middle" style="border-width:0px;" />
                    </td>
                    <td align="center" valign="middle" style="width:20px;">
                    <input type="image" name="ctl00$cphAdmin$ctl00$gridExtensionsList$ctl03$btnPriorityDwn" id="ctl00_cphAdmin_ctl00_gridExtensionsList_ctl03_btnPriorityDwn" src="../images/action-down.png" align="middle" style="border-width:0px;" />
                    </td>
                </tr>
            }      
        }         
        </tbody>
    </table>
}
